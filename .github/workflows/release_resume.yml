name: Compile LaTeX Resume and Create Release

on:
  push:
    branches: [master] # Assuming your main branch is 'master' (adjust if it's 'main')
    paths:
      - 'resume.tex' # Only run if the source LaTeX file changes
  workflow_dispatch: # Allows manual trigger

jobs:
  # 1. BUILD JOB: Compiles resume.tex into resume.pdf
  build:
    runs-on: ubuntu-latest
    
    # Use the TeXLive container to ensure all packages/fonts are available
    container:
      image: ghcr.io/xu-cheng/texlive-debian:latest

    steps:
      - uses: actions/checkout@v4

      # --- Removed Python/YAML/Jinja steps ---

      # Compile LaTeX (The container has pdflatex pre-installed)
      - name: Compile LaTeX
        run: |
          # Use pdflatex with error handling flags
          pdflatex -interaction=nonstopmode -halt-on-error resume.tex
          # Run twice for cross-references, TOC, etc.
          pdflatex -interaction=nonstopmode -halt-on-error resume.tex

      # Upload PDF artifact (using a simple, single name)
      - name: Upload PDF Artifact
        uses: actions/upload-artifact@v4
        with:
          name: compiled-resume-pdf
          path: resume.pdf # The file created by the pdflatex command
          retention-days: 7 # Reduce retention for temporary files

  # 2. RELEASE JOB: Creates a GitHub Release and attaches the PDF
  release:
    needs: build
    runs-on: ubuntu-latest
    # Run only if the push was to the master/main branch
    if: github.ref == 'refs/heads/master' # Adjust to 'refs/heads/main' if necessary
    permissions:
      contents: write

    steps:
      # Download the single artifact
      - name: Download compiled artifact
        uses: actions/download-artifact@v4
        with:
          name: compiled-resume-pdf
          path: . # Download directly to the current directory

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          # Use the commit SHA or current date for a unique tag (better than run_number for resumes)
          tag_name: Resume-${{ github.sha }}
          name: Resume PDF - ${{ github.ref_name }}
          body: Automated PDF generation for latest changes.
          # The file name must match the name used in the download step
          files: resume.pdf 
          draft: false
          prerelease: false
